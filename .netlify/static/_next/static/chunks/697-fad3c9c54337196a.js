"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{5749:(e,t,a)=>{a.d(t,{oR:()=>o});let o=a(38543).oR},31886:(e,t,a)=>{a.d(t,{Ac:()=>p,BP:()=>l,CN:()=>u,GQ:()=>c,N:()=>g,Q5:()=>m,Z_:()=>h,hD:()=>r,iP:()=>i,ig:()=>d,mC:()=>y,vY:()=>f});let o="http://localhost:5000/api";class r extends Error{constructor(e,t,a=""){super(e),this.status=t,this.statusText=a,this.name="ApiError"}}async function n(e){try{let t;let a=e.headers.get("content-type"),o={status:e.status,statusText:e.statusText,contentType:a,url:e.url};if(console.log("API response details:",o),204===e.status)return console.log("Received 204 No Content response"),{status:"success",data:[]};let n=e.clone(),s=await n.text();if(!s||""===s.trim()){if(console.log("Received empty response body"),e.ok)return{status:"success",data:[]};throw new r("Empty response with status ".concat(e.status),e.status,e.statusText)}if(a&&a.includes("application/json")){try{t=JSON.parse(s),console.log("Parsed JSON response:",t)}catch(t){if(console.error("Failed to parse JSON response:",t),console.error("Response text:",s||"(empty response)"),e.ok)return{status:"success",data:[]};throw new r("Failed to parse JSON response: "+t.message,e.status,e.statusText)}if(!e.ok){if(console.error("API error response:",t||"(empty error response)"),t&&t.errors&&Array.isArray(t.errors)){let a=t.errors.map(e=>"".concat(e.path,": ").concat(e.message)).join("; ");throw new r("Validation failed: ".concat(a),e.status,e.statusText)}if(t&&t.message&&t.message.includes("duplicate key"))throw new r("A record with this information already exists. Please check for duplicates.",e.status,e.statusText);if(t&&t.message&&t.message.includes("violates foreign key constraint"))throw new r("This operation references data that does not exist or has been deleted.",e.status,e.statusText);if(t&&t.message&&t.message.includes("database"))throw new r("Database query error: "+t.message,e.status,e.statusText);throw new r((null==t?void 0:t.message)||"API request failed with status ".concat(e.status),e.status,e.statusText)}return t&&null===t.data&&(t.data=[]),t.hasOwnProperty("data")||(t={status:"success",data:t}),t}if(console.log("Non-JSON response:",s||"(empty response)"),!e.ok)throw new r("API request failed: ".concat(s||e.statusText),e.status,e.statusText);try{return JSON.parse(s)}catch(e){return{status:"success",data:s||[]}}}catch(e){if(e instanceof r)throw e;throw console.error("Error processing API response:",e),new r("Failed to process API response: "+e.message,500)}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{let i="".concat(o).concat(e),d={"Content-Type":"application/json",...t.headers};if(console.log("API Request: ".concat(t.method||"GET"," ").concat(i)),t.body)try{let e=JSON.parse(t.body);console.log("Request body:",e)}catch(e){console.log("Request body (non-JSON or invalid):",t.body)}let c=i+(i.includes("?")?"&":"?")+"_t="+Date.now(),l=await fetch(c,{...t,headers:d});if(console.log("API Response: ".concat(l.status," ").concat(l.statusText," from ").concat(l.url)),l.status>=500){console.error("Server error: ".concat(l.status," ").concat(l.statusText));let o="";try{let e=await l.text();if(e&&""!==e.trim())try{let t=JSON.parse(e);o=t.message||t.error||e}catch(t){o=e}}catch(e){console.error("Failed to extract error details:",e)}let n=l.statusText||"Internal Server Error",i=o?"Server error (".concat(l.status,"): ").concat(n,". Details: ").concat(o):"Server error (".concat(l.status,"): ").concat(n);if(a<2)return console.log("Retrying request due to server error (".concat(a+1,"/2)...")),await new Promise(e=>setTimeout(e,1e3*(a+1))),s(e,t,a+1);throw new r(i,l.status,n)}try{return await n(l)}catch(e){if(console.error("Error handling response:",e),e instanceof r)throw e;throw new r("Failed to parse API response: "+e.message,l.status||500,l.statusText||"")}}catch(o){if(o instanceof r)throw o;if(o instanceof TypeError&&o.message.includes("Failed to fetch")){if(console.error("Network error details:",o),a<2)return console.log("Retrying request due to network error (".concat(a+1,"/2)...")),await new Promise(e=>setTimeout(e,1e3*(a+1))),s(e,t,a+1);throw new r("Cannot connect to API server. Please check if the server is running.",500)}if(o instanceof TypeError&&o.message.includes("Cross-Origin Request Blocked"))throw new r("CORS error: API server rejected the request. Check CORS configuration.",500);throw console.error("API fetch error:",o),new r("Network error or server is down: "+o.message,500)}}let i={getAll:()=>s("/clients"),getById:e=>s("/clients/".concat(e)),create:e=>s("/clients",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>s("/clients/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>s("/clients/".concat(e),{method:"DELETE"}),getOrders:e=>s("/clients/".concat(e,"/orders")),getInvoices:e=>s("/clients/".concat(e,"/invoices")),getLogs:e=>s("/clients/".concat(e,"/logs"))},d={getAll:()=>s("/providers"),getById:e=>s("/providers/".concat(e)),create:e=>s("/providers",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>s("/providers/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>s("/providers/".concat(e),{method:"DELETE"}),getProducts:e=>s("/providers/".concat(e,"/products")),getOrders:e=>s("/providers/".concat(e,"/orders"))},c={getAll:()=>s("/products"),getById:e=>s("/products/".concat(e)),create:e=>s("/products",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>s("/products/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>s("/products/".concat(e),{method:"DELETE"}),getByCategory:e=>s("/products/category/".concat(e)),getByBrand:e=>s("/products/brand/".concat(e)),getLowStock:()=>s("/products/low-stock"),updateQuantity:(e,t)=>s("/products/".concat(e,"/quantity"),{method:"PATCH",body:JSON.stringify({quantity:t})})},l={getAll:async()=>await s("/categories"),getById:async e=>await s("/categories/".concat(e)),create:async e=>await s("/categories",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>await s("/categories/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>await s("/categories/".concat(e),{method:"DELETE"}),bulkUpload:async e=>{let t=await fetch("".concat(o,"/categories/bulk-upload"),{method:"POST",body:e});if(!t.ok)throw new r((await t.json()).message||"Failed to upload categories (".concat(t.status,")"),t.status,t.statusText);return t.json()}},u={getAll:async()=>await s("/brands"),getById:async e=>await s("/brands/".concat(e)),create:async e=>await s("/brands",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>await s("/brands/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>await s("/brands/".concat(e),{method:"DELETE"}),bulkUpload:async e=>{let t=await fetch("".concat(o,"/brands/bulk-upload"),{method:"POST",body:e});if(!t.ok)throw new r((await t.json()).message||"Failed to upload brands (".concat(t.status,")"),t.status,t.statusText);return t.json()}},p={getAll:async()=>await s("/professional-domains"),getById:async e=>await s("/professional-domains/".concat(e)),create:async e=>await s("/professional-domains",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>await s("/professional-domains/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>await s("/professional-domains/".concat(e),{method:"DELETE"}),bulkUpload:async e=>{let t=await fetch("".concat(o,"/professional-domains/bulk-upload"),{method:"POST",body:e});if(!t.ok)throw new r((await t.json()).message||"Failed to upload professional domains (".concat(t.status,")"),t.status,t.statusText);return t.json()},getClientsByDomain:async e=>await s("/professional-domains/".concat(e,"/clients"))},m={getAll:()=>s("/invoices"),getById:e=>s("/invoices/".concat(e)),create:e=>s("/invoices",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>s("/invoices/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>s("/invoices/".concat(e),{method:"DELETE"}),getByStatus:e=>s("/invoices/status/".concat(e)),updateStatus:(e,t)=>s("/invoices/".concat(e,"/status"),{method:"PATCH",body:JSON.stringify(t)})},g={getAll:()=>s("/orders"),getById:e=>s("/orders/".concat(e)),create:e=>s("/orders",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>s("/orders/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>s("/orders/".concat(e),{method:"DELETE"}),getByStatus:e=>s("/orders/status/".concat(e)),updateStatus:(e,t)=>s("/orders/".concat(e,"/status"),{method:"PATCH",body:JSON.stringify({status:t})}),createInvoice:e=>s("/orders/".concat(e,"/create-invoice"),{method:"POST"}),getLogs:e=>s("/orders/".concat(e,"/logs"))},y={getAll:()=>s("/client-logs"),getById:e=>s("/client-logs/".concat(e)),create:e=>s("/client-logs",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>s("/client-logs/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>s("/client-logs/".concat(e),{method:"DELETE"}),getByClient:e=>s("/client-logs/client/".concat(e)),getByDateRange:(e,t)=>s("/client-logs/date-range?startDate=".concat(e,"&endDate=").concat(t)),getToday:()=>s("/client-logs/today")},h={getAll:()=>s("/order-logs"),getById:e=>s("/order-logs/".concat(e)),create:e=>s("/order-logs",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>s("/order-logs/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>s("/order-logs/".concat(e),{method:"DELETE"}),getByOrder:e=>s("/order-logs/order/".concat(e)),getByDateRange:(e,t)=>s("/order-logs/date-range?start_date=".concat(e,"&end_date=").concat(t)),getToday:()=>s("/order-logs/today")},f={getByLogId:e=>s("/order-log-entries/log/".concat(e)),addOrderToLog:e=>s("/order-log-entries",{method:"POST",body:JSON.stringify(e)}),addMultipleOrdersToLog:e=>s("/order-log-entries/batch",{method:"POST",body:JSON.stringify(e)}),removeOrderFromLog:e=>s("/order-log-entries/".concat(e),{method:"DELETE"})}},53999:(e,t,a)=>{a.d(t,{cn:()=>n});var o=a(52596),r=a(39688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,o.$)(t))}},79159:(e,t,a)=>{a.d(t,{CRMProvider:()=>c,m:()=>l});var o=a(95155),r=a(12115),n=a(31886),s=a(5749);let i=(0,r.createContext)(void 0),d={providers:[],clients:[],categories:[],brands:[],professionalDomains:[],products:[],invoices:[],orders:[]};function c(e){let{children:t}=e,[a,c]=(0,r.useState)(d),[l,u]=(0,r.useState)(!0),[p,m]=(0,r.useState)(null),[g,y]=(0,r.useState)(null),[h,f]=(0,r.useState)("online"),[_,v]=(0,r.useState)(0),b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"API operation";console.error("Error in ".concat(t,":"),e);let a="";if(e instanceof n.hD){if(e.message&&e.message.includes("still referenced from table")){let t=e.message.match(/referenced from table "([^"]+)"/);if(t&&t[1]){let e=t[1];a="Cannot delete this item because it is referenced by ".concat(e,". Please delete the associated ").concat(e," first.")}else a="Cannot delete this item because it is referenced by other records in the system."}else a="".concat(e.message);m(a),y({status:e.status,message:e.message,timestamp:Date.now()})}else m(e.message||"Failed in ".concat(t)),y({status:0,message:e.message||"Unknown error",timestamp:Date.now()})},w=async()=>{u(!0),m(null),y(null);try{let[e,t,a,o,r,s,i]=await Promise.allSettled([n.iP.getAll(),n.ig.getAll(),n.BP.getAll(),n.CN.getAll(),n.Ac.getAll(),n.GQ.getAll(),n.Q5.getAll()]),l=e=>{if("fulfilled"===e.status){var t;return(null===(t=e.value)||void 0===t?void 0:t.data)||[]}{let t=e.reason;return console.error("Error fetching data:",t),t instanceof n.hD?(y({status:t.status,message:t.message,timestamp:Date.now()}),t.status>=500?m("Server error (".concat(t.status,"): ").concat(t.message)):m("API error: ".concat(t.message))):m("Error fetching data: ".concat((null==t?void 0:t.message)||"Unknown error")),[]}},u=l(e),p=l(t),g=l(a),h=l(o),f=l(r),_=l(s),b=l(i);console.log("Raw invoice data from API:",b);try{let e=u.map(e=>({id:e.id,gender:e.gender||"",firstName:e.first_name||"",lastName:e.last_name||"",email:e.email||"",address:e.address||"",phoneNumber:e.phone||"",birthDate:e.birth_date?new Date(e.birth_date):new Date,professionalDomain:e.professional_domain_name||"",professionalDomainCode:e.professional_domain_code||"",revenue:parseFloat(e.revenue)||0,ccpAccount:e.ccp_account||"",cle:e.cle||"",rip:e.rip||"",ripCle:e.rip_cle||"",notes:e.notes||"",createdAt:new Date(e.created_at)})),t=p.map(e=>({id:e.id,name:e.name||"",email:e.email||"",address:e.address||"",phoneNumber:e.phone||"",createdAt:new Date(e.created_at)})),a=_.map(e=>({id:e.id,name:e.name||"",description:e.description||"",reference:e.reference||"",sku:e.sku||"",category:{id:e.category_id||"",name:e.category_name||"Uncategorized"},brand:{id:e.brand_id||"",name:e.brand_name||"Unbranded"},sellPrice:parseFloat(e.sell_price)||0,buyPrice:parseFloat(e.buy_price)||0,quantity:parseInt(e.quantity)||0,createdAt:new Date(e.created_at)})),o=b.map(e=>{if(console.log("Processing invoice:",e.id,"Provider ID:",e.provider_id),!e||"object"!=typeof e)return console.error("Invalid invoice data:",e),null;try{return{id:e.id||"",invoice_number:e.invoice_number||"INV-".concat((e.id||"").substring(0,8)),provider_id:e.provider_id||"",provider_name:e.provider_name||"Unknown Provider",provider_email:e.provider_email||"",provider_phone:e.provider_phone||"",provider_address:e.provider_address||"",items:Array.isArray(e.items)?e.items.map(e=>({id:(null==e?void 0:e.id)||"",product_id:(null==e?void 0:e.product_id)||"",product_name:(null==e?void 0:e.product_name)||"Unknown Product",product_description:(null==e?void 0:e.product_description)||"",quantity:parseInt(null==e?void 0:e.quantity)||0,unit_price:parseFloat(null==e?void 0:e.unit_price)||0,discount:parseFloat(null==e?void 0:e.discount)||0,total:parseFloat(null==e?void 0:e.total)||parseInt((null==e?void 0:e.quantity)||0)*(parseFloat((null==e?void 0:e.unit_price)||0)||0),sku:(null==e?void 0:e.sku)||"",reference:(null==e?void 0:e.reference)||"",category_id:(null==e?void 0:e.category_id)||"",category_name:(null==e?void 0:e.category_name)||"Uncategorized",brand_id:(null==e?void 0:e.brand_id)||"",brand_name:(null==e?void 0:e.brand_name)||"Unbranded"})):[],subtotal:parseFloat(e.subtotal)||0,total:parseFloat(e.total)||0,tax_rate:parseFloat(e.tax_rate)||0,status:e.status||"draft",date:e.date||new Date().toISOString().split("T")[0],due_date:e.due_date||"",notes:e.notes||"",created_at:e.created_at||new Date().toISOString(),updated_at:e.updated_at||new Date().toISOString()}}catch(t){return console.error("Error transforming invoice:",e.id,t),null}}).filter(Boolean);console.log("Transformed invoices count:",o.length);let r=f.map(e=>({id:e.id,name:e.name||"",description:e.description||"",paymentCode:e.payment_code||""}));c({clients:e,providers:t,categories:g||[],brands:h||[],professionalDomains:r,products:a,invoices:o,orders:[]})}catch(e){console.error("Error transforming data:",e),c(d),m("Error processing data: "+e.message)}v(Date.now())}catch(e){console.error("Failed to fetch CRM data:",e),b(e,"fetching CRM data"),c({clients:[],providers:[],categories:[],brands:[],professionalDomains:[],products:[],invoices:[],orders:[]})}finally{u(!1)}};(0,r.useEffect)(()=>{w()},[]),(0,r.useEffect)(()=>{let e=()=>{console.log("Network is back online. Refreshing data..."),f("online"),w()},t=()=>{console.log("Network is offline"),f("offline")},a=()=>{"visible"===document.visibilityState&&Date.now()-_>3e5&&w()};return window.addEventListener("online",e),window.addEventListener("offline",t),document.addEventListener("visibilitychange",a),f(navigator.onLine?"online":"offline"),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t),document.removeEventListener("visibilitychange",a)}},[_]);let D=()=>(console.log("Manually refreshing data..."),w().then(()=>{console.log("Data refresh completed successfully")}).catch(e=>{throw console.error("Data refresh failed:",e),e})),P=async e=>{try{let t={name:e.name,email:e.email,address:e.address,phone:e.phoneNumber,status:"active"},a=await n.ig.create(t),o={...a.data,phoneNumber:a.data.phone,createdAt:new Date(a.data.created_at)};return c(e=>({...e,providers:[...e.providers,o]})),s.oR.success("".concat(e.name," has been added to your providers."),{position:"top-right",autoClose:3e3}),o}catch(e){throw b(e,"adding provider"),e}},S=async(e,t)=>{try{let a={name:t.name||"",email:t.email||"",address:t.address||"",phone:t.phoneNumber||""},o=await n.ig.update(e,a),r={...o.data,phoneNumber:o.data.phone,createdAt:new Date(o.data.created_at)};return c(t=>({...t,providers:t.providers.map(t=>t.id===e?r:t)})),r}catch(e){throw b(e,"updating provider"),e}},N=async e=>{try{let t=a.providers.find(t=>t.id===e);await n.ig.delete(e),c(t=>({...t,providers:t.providers.filter(t=>t.id!==e)})),s.oR.success("".concat((null==t?void 0:t.name)||"Provider"," has been deleted successfully."),{position:"top-right",autoClose:3e3})}catch(e){throw b(e,"deleting provider"),e}},A=async e=>{try{var t;let o={gender:e.gender,first_name:e.firstName,last_name:e.lastName,email:e.email,phone:e.phoneNumber,address:e.address,professional_domain_id:e.professionalDomain?null===(t=a.professionalDomains.find(t=>t.name===e.professionalDomain))||void 0===t?void 0:t.id:null,birth_date:e.birthDate,ccp_account:e.ccpAccount,cle:e.cle,rip:e.rip,rip_cle:e.ripCle,revenue:e.revenue||0,company:"",status:"active",notes:e.notes||""},r=await n.iP.create(o),i={...r.data,firstName:r.data.first_name,lastName:r.data.last_name,gender:r.data.gender,phoneNumber:r.data.phone,professionalDomain:r.data.professional_domain_name||"",birthDate:r.data.birth_date?new Date(r.data.birth_date):null,ccpAccount:r.data.ccp_account||"",cle:r.data.cle||"",rip:r.data.rip||"",ripCle:r.data.rip_cle||"",revenue:r.data.revenue||0,createdAt:new Date(r.data.created_at)};return c(e=>({...e,clients:[...e.clients,i]})),s.oR.success("".concat(e.firstName," ").concat(e.lastName," has been added to your clients."),{position:"top-right",autoClose:3e3}),i}catch(e){throw b(e,"adding client"),e}},T=async(e,t)=>{try{var o;let r={gender:t.gender||"",first_name:t.firstName||"",last_name:t.lastName||"",email:t.email||"",phone:t.phoneNumber||"",address:t.address||"",professional_domain_id:t.professionalDomain?null===(o=a.professionalDomains.find(e=>e.name===t.professionalDomain))||void 0===o?void 0:o.id:null,birth_date:t.birthDate,ccp_account:t.ccpAccount||"",cle:t.cle||"",rip:t.rip||"",rip_cle:t.ripCle||"",revenue:t.revenue||0,notes:t.notes||""},s=await n.iP.update(e,r),i={...s.data,firstName:s.data.first_name,lastName:s.data.last_name,gender:s.data.gender,phoneNumber:s.data.phone,professionalDomain:s.data.professional_domain_name||"",birthDate:s.data.birth_date?new Date(s.data.birth_date):null,ccpAccount:s.data.ccp_account||"",cle:s.data.cle||"",rip:s.data.rip||"",ripCle:s.data.rip_cle||"",revenue:s.data.revenue||0,createdAt:new Date(s.data.created_at)};return c(t=>({...t,clients:t.clients.map(t=>t.id===e?i:t)})),i}catch(e){throw b(e,"updating client"),e}},O=async e=>{try{let t=a.clients.find(t=>t.id===e);await n.iP.delete(e),c(t=>({...t,clients:t.clients.filter(t=>t.id!==e)})),s.oR.success("".concat(t?"".concat(t.firstName," ").concat(t.lastName):"Client"," has been deleted successfully."),{position:"top-right",autoClose:3e3})}catch(e){throw b(e,"deleting client"),e}},E=async e=>{try{let t={name:e.name,description:e.description||"",sell_price:e.sellPrice,buy_price:e.buyPrice,quantity:e.quantity,category_id:e.categoryId,brand_id:e.brandId,reference:e.reference||"",sku:e.sku||"",image_url:e.imageUrl||""},a=await n.GQ.create(t),o={...a.data,sellPrice:Number(a.data.sell_price||0),buyPrice:Number(a.data.buy_price||0),categoryId:a.data.category_id,brandId:a.data.brand_id,categoryName:a.data.category_name,brandName:a.data.brand_name,imageUrl:a.data.image_url,createdAt:new Date(a.data.created_at)};return c(e=>({...e,products:[...e.products,o]})),s.oR.success("".concat(e.name," has been added to your products."),{position:"top-right",autoClose:3e3}),o}catch(e){throw b(e,"adding product"),e}},I=async(e,t)=>{try{let a={name:t.name,description:t.description||"",sell_price:t.sellPrice,buy_price:t.buyPrice,quantity:t.quantity,category_id:t.categoryId,brand_id:t.brandId,reference:t.reference||"",sku:t.sku||"",image_url:t.imageUrl||""},o=await n.GQ.update(e,a),r={...o.data,sellPrice:Number(o.data.sell_price||0),buyPrice:Number(o.data.buy_price||0),categoryId:o.data.category_id,brandId:o.data.brand_id,categoryName:o.data.category_name,brandName:o.data.brand_name,imageUrl:o.data.image_url,createdAt:new Date(o.data.created_at)};return c(t=>({...t,products:t.products.map(t=>t.id===e?r:t)})),r}catch(e){throw b(e,"updating product"),e}},C=async e=>{try{let t=a.products.find(t=>t.id===e);await n.GQ.delete(e),c(t=>({...t,products:t.products.filter(t=>t.id!==e)})),s.oR.success("".concat((null==t?void 0:t.name)||"Product"," has been deleted successfully."),{position:"top-right",autoClose:3e3})}catch(e){throw b(e,"deleting product"),e}},k=async e=>{try{let t=(await n.BP.create({name:e})).data;return c(e=>({...e,categories:[...e.categories,t]})),s.oR.success("".concat(e," has been added to your categories."),{position:"top-right",autoClose:3e3}),t}catch(e){throw b(e,"adding category"),e}},x=async(e,t)=>{try{var a;let o={...t,description:null!==(a=t.description)&&void 0!==a?a:""},r=(await n.BP.update(e,o)).data;return c(t=>({...t,categories:t.categories.map(t=>t.id===e?{...t,...r}:t)})),r}catch(e){throw b(e,"updating category"),e}},R=async e=>{try{let t=a.categories.find(t=>t.id===e);await n.BP.delete(e),c(t=>({...t,categories:t.categories.filter(t=>t.id!==e)})),s.oR.success("".concat((null==t?void 0:t.name)||"Category"," has been deleted successfully."),{position:"top-right",autoClose:3e3})}catch(e){throw b(e,"deleting category"),e}},J=async e=>{try{let t=(await n.CN.create({name:e})).data;return c(e=>({...e,brands:[...e.brands,t]})),s.oR.success("".concat(e," has been added to your brands."),{position:"top-right",autoClose:3e3}),t}catch(e){throw b(e,"adding brand"),e}},U=async(e,t)=>{try{var a;let o={...t,description:null!==(a=t.description)&&void 0!==a?a:""},r=(await n.CN.update(e,o)).data;return c(t=>({...t,brands:t.brands.map(t=>t.id===e?{...t,...r}:t)})),r}catch(e){throw b(e,"updating brand"),e}},B=async e=>{try{let t=a.brands.find(t=>t.id===e);await n.CN.delete(e),c(t=>({...t,brands:t.brands.filter(t=>t.id!==e)})),s.oR.success("".concat((null==t?void 0:t.name)||"Brand"," has been deleted successfully."),{position:"top-right",autoClose:3e3})}catch(e){throw b(e,"deleting brand"),e}},q=async e=>{try{let t={name:e.name,description:e.description||"",payment_code:e.paymentCode||""},a=await n.Ac.create(t),o={...a.data,paymentCode:a.data.payment_code||"",createdAt:new Date(a.data.created_at)};return c(e=>({...e,professionalDomains:[...e.professionalDomains,o]})),s.oR.success("".concat(e.name," has been added to your professional domains."),{position:"top-right",autoClose:3e3}),o}catch(e){throw b(e,"adding professional domain"),e}},L=async(e,t)=>{try{let a={name:t.name||"",description:t.description||"",payment_code:t.paymentCode||""},o=await n.Ac.update(e,a),r={...o.data,paymentCode:o.data.payment_code||"",createdAt:new Date(o.data.created_at)};return c(t=>({...t,professionalDomains:t.professionalDomains.map(t=>t.id===e?r:t)})),r}catch(e){throw b(e,"updating professional domain"),e}},F=async e=>{try{let t=a.professionalDomains.find(t=>t.id===e);await n.Ac.delete(e),c(t=>({...t,professionalDomains:t.professionalDomains.filter(t=>t.id!==e)})),s.oR.success("".concat((null==t?void 0:t.name)||"Professional domain"," has been deleted successfully."),{position:"top-right",autoClose:3e3})}catch(e){throw b(e,"deleting professional domain"),e}},Q=async e=>{try{if(!e.items||0===e.items.length)throw Error("At least one invoice item is required");if(!e.client_id&&!e.provider_id)throw Error("Either client or provider must be selected");console.log("Sending invoice data:",JSON.stringify(e,null,2));let t=await n.Q5.create(e);return console.log("Invoice creation response:",t),s.oR.success("Invoice #".concat(t.data.invoice_number||"New"," has been created successfully."),{position:"top-right",autoClose:3e3}),await D(),t.data}catch(e){throw console.error("Detailed invoice creation error:",e),e instanceof n.hD&&console.error("API Error details:",e.status,e.message),b(e,"invoice creation"),e}},j=async(e,t)=>{try{let a=t.provider_id||t.provider&&t.provider.id,o=t.client_id||t.client&&t.client.id;if(!a&&!o)throw console.error("Neither Provider ID nor Client ID is present in invoice data:",t),Error("Either Provider ID or Client ID is required for updating an invoice");let r=a?"provider":"client",s=a||o;console.log("Updating invoice ".concat(e," with ").concat(r," ID: ").concat(s));let i=null;if(t.due_date)i=t.due_date;else if(t.dueDate){if(t.dueDate instanceof Date)i=t.dueDate.toISOString().split("T")[0];else if("string"==typeof t.dueDate){let e=t.dueDate.match(/^\d{4}-\d{2}-\d{2}/);i=e?e[0]:null}}console.log("Formatted due date:",i);let d={...a?{provider_id:a}:{client_id:o},date:t.date,due_date:i,status:t.status||"draft",notes:t.notes||"",tax_rate:t.tax_rate||0,items:t.items.map(e=>({id:null===e.id||void 0===e.id||"string"==typeof e.id&&(e.id.startsWith("temp-")||!e.id.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i))?null:e.id,product_id:e.product_id||e.product&&e.product.id,quantity:e.quantity,unit_price:Math.max(.01,e.unit_price||e.unitPrice||0),discount:e.discount||0}))};console.log("Backend invoice update data:",JSON.stringify(d,null,2));let l=(await n.Q5.update(e,d)).data;console.log("Invoice updated:",l);let u={id:l.id,invoice_number:l.invoice_number||"INV-".concat(l.id.substring(0,8)),provider_id:l.provider_id,provider_name:l.provider_name||"",provider_email:l.provider_email||"",provider_phone:l.provider_phone||"",provider_address:l.provider_address||"",items:Array.isArray(l.items)?l.items.map(e=>({id:e.id,product_id:e.product_id,product_name:e.product_name,product_description:e.product_description||"",quantity:e.quantity,unit_price:e.unit_price,discount:e.discount||0,total:e.total,sku:e.sku||"",reference:e.reference||"",category_id:e.category_id||"",category_name:e.category_name||"Uncategorized",brand_id:e.brand_id||"",brand_name:e.brand_name||"Unbranded"})):t.items.map(e=>({id:e.id||"temp-".concat(Date.now().toString()),product_id:e.product_id||e.product&&e.product.id||"",product_name:e.product_name||e.product&&e.product.name||"Unknown Product",product_description:e.product_description||e.product&&e.product.description||"",quantity:e.quantity,unit_price:e.unit_price||e.unitPrice||0,discount:e.discount||0,total:e.total||e.quantity*(e.unit_price||e.unitPrice||0)*(1-(e.discount||0)/100),sku:e.sku||e.product&&e.product.sku||"",reference:e.reference||e.product&&e.product.reference||"",category_id:e.category_id||e.product&&e.product.category&&e.product.category.id||"",category_name:e.category_name||e.product&&e.product.category&&e.product.category.name||"Uncategorized",brand_id:e.brand_id||e.product&&e.product.brand&&e.product.brand.id||"",brand_name:e.brand_name||e.product&&e.product.brand&&e.product.brand.name||"Unbranded"})),subtotal:l.subtotal||t.subtotal||0,total:l.total||t.total||0,tax_rate:l.tax_rate||t.tax_rate||0,status:l.status||t.status||"draft",date:l.date||t.date||"",due_date:l.due_date||t.due_date||"",notes:l.notes||t.notes||"",created_at:l.created_at||new Date().toISOString(),updated_at:l.updated_at||new Date().toISOString()};return c(t=>({...t,invoices:t.invoices.map(t=>t.id===e?u:t)})),u}catch(e){throw b(e,"updating invoice"),e}},M=async e=>{try{let t=a.invoices.find(t=>t.id===e);await n.Q5.delete(e),c(t=>({...t,invoices:t.invoices.filter(t=>t.id!==e)})),s.oR.success("Invoice #".concat((null==t?void 0:t.invoice_number)||e," has been deleted successfully."),{position:"top-right",autoClose:3e3})}catch(e){throw b(e,"deleting invoice"),e}},G=async(e,t)=>{try{console.log("Updating invoice ".concat(e," status to ").concat(t));let o=(await n.Q5.updateStatus(e,{status:t})).data;console.log("Invoice status updated:",o);let r=a.invoices.find(t=>t.id===e);if(!r)throw console.error("Invoice ".concat(e," not found in state")),Error("Invoice ".concat(e," not found in state"));let s={...r,status:t,provider_id:o.provider_id||r.provider_id,provider_name:o.provider_name||r.provider_name,provider_email:o.provider_email||r.provider_email,provider_phone:o.provider_phone||r.provider_phone,provider_address:o.provider_address||r.provider_address,updated_at:new Date().toISOString()};return c(t=>({...t,invoices:t.invoices.map(t=>t.id===e?s:t)})),s}catch(e){throw b(e,"updating invoice status"),e}},z=async e=>{try{let t=await n.BP.bulkUpload(e);return t.data&&Array.isArray(t.data)&&c(e=>({...e,categories:[...e.categories,...t.data]})),t}catch(e){throw b(e,"bulk uploading categories"),e}},H=async e=>{try{let t=await n.CN.bulkUpload(e);return t.data&&Array.isArray(t.data)&&c(e=>({...e,brands:[...e.brands,...t.data]})),t}catch(e){throw b(e,"bulk uploading brands"),e}},V=async e=>{try{let t=await n.Ac.bulkUpload(e);if(t.data&&Array.isArray(t.data)){let e=t.data.map(e=>({...e,paymentCode:e.payment_code||"",createdAt:new Date(e.created_at)}));c(t=>({...t,professionalDomains:[...t.professionalDomains,...e]}))}return t}catch(e){throw b(e,"bulk uploading professional domains"),e}};return(0,o.jsx)(i.Provider,{value:{data:a,loading:l,error:p,errorDetails:g,clearError:()=>{m(null),y(null)},networkStatus:h,lastFetchTime:_,refreshData:D,addProvider:P,updateProvider:S,deleteProvider:N,addClient:A,updateClient:T,deleteClient:O,addProduct:E,updateProduct:I,deleteProduct:C,addCategory:k,updateCategory:x,deleteCategory:R,addBrand:J,updateBrand:U,deleteBrand:B,addProfessionalDomain:q,updateProfessionalDomain:L,deleteProfessionalDomain:F,addInvoice:Q,updateInvoice:j,deleteInvoice:M,updateInvoiceStatus:G,bulkUploadCategories:z,bulkUploadBrands:H,bulkUploadProfessionalDomains:V},children:t})}function l(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useCRM must be used within a CRMProvider");return e}}}]);