(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2367],{12486:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(19946).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},27809:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(19946).A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},32919:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(19946).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},42535:(e,s,t)=>{Promise.resolve().then(t.bind(t,75907))},53904:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(19946).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},55868:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(19946).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},68780:(e,s,t)=>{"use strict";t.d(s,{Z:()=>v});var a=t(95155),r=t(12115),l=t(97168),d=t(20547),n=t(53999);let i=d.bL,o=d.l9,c=r.forwardRef((e,s)=>{let{className:t,align:r="center",sideOffset:l=4,...i}=e;return(0,a.jsx)(d.ZL,{children:(0,a.jsx)(d.UC,{ref:s,align:r,sideOffset:l,className:(0,n.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})})});c.displayName=d.UC.displayName;var x=t(77740),h=t(47924);t(99840);let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(x.uB,{ref:s,className:(0,n.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...r})});u.displayName=x.uB.displayName;let m=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,a.jsx)(x.uB.Input,{ref:s,className:(0,n.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...r})]})});m.displayName=x.uB.Input.displayName;let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(x.uB.List,{ref:s,className:(0,n.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...r})});p.displayName=x.uB.List.displayName;let g=r.forwardRef((e,s)=>(0,a.jsx)(x.uB.Empty,{ref:s,className:"py-6 text-center text-sm",...e}));g.displayName=x.uB.Empty.displayName;let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(x.uB.Group,{ref:s,className:(0,n.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...r})});j.displayName=x.uB.Group.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(x.uB.Separator,{ref:s,className:(0,n.cn)("-mx-1 h-px bg-border",t),...r})}).displayName=x.uB.Separator.displayName;let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(x.uB.Item,{ref:s,className:(0,n.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...r})});f.displayName=x.uB.Item.displayName;var y=t(10081),N=t(5196);function v(e){let{value:s,onValueChange:t,options:d,placeholder:x,searchPlaceholder:h,className:v}=e,[w,b]=(0,r.useState)(!1),[A,S]=(0,r.useState)(""),C=d.find(e=>e.value===s),D=d.filter(e=>{let s=A.toLowerCase();return e.label.toLowerCase().includes(s)||e.category&&e.category.toLowerCase().includes(s)||e.brand&&e.brand.toLowerCase().includes(s)||e.description&&e.description.toLowerCase().includes(s)||e.email&&e.email.toLowerCase().includes(s)||e.domain&&e.domain.toLowerCase().includes(s)});return(0,a.jsxs)(i,{open:w,onOpenChange:b,children:[(0,a.jsx)(o,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"outline",role:"combobox","aria-expanded":w,className:(0,n.cn)("w-full justify-between",v),children:[C?C.label:x,(0,a.jsx)(y.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(c,{className:"w-full p-0",align:"start",children:(0,a.jsxs)(u,{shouldFilter:!1,children:[(0,a.jsx)(m,{placeholder:h,value:A,onValueChange:S}),(0,a.jsxs)(p,{children:[(0,a.jsx)(g,{children:"No item found."}),(0,a.jsx)(j,{className:"max-h-64 overflow-auto",children:D.map(e=>(0,a.jsxs)(f,{value:e.value,onSelect:e=>{t(e===s?"":e),b(!1),S("")},children:[(0,a.jsx)(N.A,{className:(0,n.cn)("mr-2 h-4 w-4",s===e.value?"opacity-100":"opacity-0")}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.label}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.category&&(0,a.jsx)("span",{className:"bg-gray-100 px-2 py-0.5 rounded text-xs",children:e.category}),e.brand&&(0,a.jsx)("span",{className:"bg-blue-100 px-2 py-0.5 rounded text-xs",children:e.brand}),e.email&&(0,a.jsx)("span",{className:"text-blue-600",children:e.email}),e.domain&&(0,a.jsx)("span",{className:"bg-green-100 px-2 py-0.5 rounded text-xs",children:e.domain}),void 0!==e.price&&"number"==typeof e.price&&(0,a.jsxs)("span",{className:"font-medium text-green-600",children:["$",e.price.toFixed(2)]})]})]})]},e.value))})]})]})})]})}},75907:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>W});var a=t(95155),r=t(12115),l=t(97168),d=t(89852),n=t(88145),i=t(88524),o=t(88482),c=t(99840),x=t(16559),h=t(82714),u=t(99474),m=t(95784),p=t(49251),g=t(58642),j=t(68780),f=t(79159),y=t(71007),N=t(28883),v=t(19420),w=t(4516),b=t(37108),A=t(84616);let S=(0,t(19946).A)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),C=[],D=[];function I(e){C.push(e),D.forEach(e=>e(C)),setTimeout(()=>{C=C.filter(s=>s!==e),D.forEach(e=>e(C))},e.duration||3e3)}function O(e){let{onSubmit:s,trigger:t}=e,{data:n}=(0,f.m)(),[x,p]=(0,r.useState)(!1),[g,C]=(0,r.useState)({clientId:"",items:[],notes:"",expectedDelivery:"",shippingAddress:"",status:"pending"}),D=c.zM,O=c.L3,_=m.bq,L=m.gC,k=m.eb,[R,P]=(0,r.useState)({productId:"",quantity:1,unitPrice:0}),F=n.clients.map(e=>({value:e.id,label:"".concat(e.gender," ").concat(e.firstName," ").concat(e.lastName),email:e.email,phone:e.phoneNumber})),Z=n.products.map(e=>({value:e.id,label:e.name,price:e.sellPrice,reference:e.reference})),B=n.clients.find(e=>e.id===g.clientId),T=n.products.find(e=>e.id===R.productId),q=e=>{C({...g,items:g.items.filter(s=>s.id!==e)})},U=(e,s)=>{s<=0||C({...g,items:g.items.map(t=>t.id===e?{...t,quantity:s,total:t.unitPrice*s}:t)})},E=()=>g.items.reduce((e,s)=>e+s.total,0);return(0,a.jsxs)(c.lG,{open:x,onOpenChange:p,children:[(0,a.jsx)(D,{asChild:!0,children:t}),(0,a.jsxs)(c.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(c.c7,{children:(0,a.jsx)(O,{children:"Create New Order"})}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!g.clientId){I({title:"Client required",description:"Please select a client for this order."});return}if(0===g.items.length){I({title:"Items required",description:"Please add at least one item to the order."});return}let t=n.clients.find(e=>e.id===g.clientId);t&&(s({id:"ORD-".concat(Date.now()),client:{id:t.id,name:"".concat(t.firstName," ").concat(t.lastName),email:t.email,phone:t.phoneNumber,address:t.address},items:g.items,subtotal:E(),total:E(),status:g.status,notes:g.notes,shippingAddress:g.shippingAddress||t.address,expectedDelivery:new Date(g.expectedDelivery?g.expectedDelivery:Date.now()+6048e5),createdAt:new Date}),C({clientId:"",items:[],notes:"",expectedDelivery:"",shippingAddress:"",status:"pending"}),P({productId:"",quantity:1,unitPrice:0}),p(!1),I({title:"Order created successfully",description:"The order has been created and added to the system."}))},className:"space-y-6",children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsxs)(o.ZB,{className:"flex items-center space-x-2",children:[(0,a.jsx)(y.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Client Information"})]})}),(0,a.jsxs)(o.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Select Client"}),(0,a.jsx)(j.Z,{value:g.clientId,onValueChange:e=>C({...g,clientId:e}),options:F,placeholder:"Select client",searchPlaceholder:"Search clients..."})]}),B&&(0,a.jsx)("div",{className:"p-4 bg-muted rounded-lg",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(N.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:B.email})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:B.phoneNumber})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 col-span-2",children:[(0,a.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:B.address})]})]})})]})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsxs)(o.ZB,{className:"flex items-center space-x-2",children:[(0,a.jsx)(b.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Order Items"})]})}),(0,a.jsxs)(o.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Product"}),(0,a.jsx)(j.Z,{value:R.productId,onValueChange:e=>{let s=n.products.find(s=>s.id===e);P({...R,productId:e,unitPrice:(null==s?void 0:s.sellPrice)||0})},options:Z,placeholder:"Select product",searchPlaceholder:"Search products..."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Quantity"}),(0,a.jsx)(d.p,{type:"number",min:"1",value:R.quantity,onChange:e=>P({...R,quantity:Number.parseInt(e.target.value)||1})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Unit Price (DZD)"}),(0,a.jsx)(d.p,{type:"number",step:"0.01",value:R.unitPrice,onChange:e=>P({...R,unitPrice:Number.parseFloat(e.target.value)||0})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"\xa0"}),(0,a.jsxs)(l.$,{type:"button",onClick:()=>{if(R.productId&&R.quantity>0){let e=n.products.find(e=>e.id===R.productId);if(e){let s={id:Date.now().toString(),product:e,quantity:R.quantity,unitPrice:R.unitPrice||e.sellPrice,total:(R.unitPrice||e.sellPrice)*R.quantity};C({...g,items:[...g.items,s]}),P({productId:"",quantity:1,unitPrice:0})}}},disabled:!R.productId,className:"w-full",children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Add Item"]})]})]}),T&&(0,a.jsx)("div",{className:"p-3 bg-muted rounded text-sm",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{children:["Reference: ",T.reference]}),(0,a.jsxs)("span",{children:["Available: ",T.quantity," units"]})]})}),g.items.length>0&&(0,a.jsxs)("div",{className:"border rounded-lg",children:[(0,a.jsxs)(i.XI,{children:[(0,a.jsx)(i.A0,{children:(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(i.nd,{children:"Product"}),(0,a.jsx)(i.nd,{children:"Quantity"}),(0,a.jsx)(i.nd,{children:"Unit Price"}),(0,a.jsx)(i.nd,{children:"Total"}),(0,a.jsx)(i.nd,{children:"Actions"})]})}),(0,a.jsx)(i.BF,{children:g.items.map(e=>(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.product.name}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:e.product.reference})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(l.$,{type:"button",variant:"outline",size:"sm",onClick:()=>U(e.id,e.quantity-1),children:(0,a.jsx)(S,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"w-8 text-center",children:e.quantity}),(0,a.jsx)(l.$,{type:"button",variant:"outline",size:"sm",onClick:()=>U(e.id,e.quantity+1),children:(0,a.jsx)(A.A,{className:"h-3 w-3"})})]})}),(0,a.jsxs)(i.nA,{children:[e.unitPrice.toLocaleString()," DZD"]}),(0,a.jsxs)(i.nA,{className:"font-medium",children:[e.total.toLocaleString()," DZD"]}),(0,a.jsx)(i.nA,{children:(0,a.jsx)(l.$,{type:"button",variant:"outline",size:"sm",onClick:()=>q(e.id),children:"Remove"})})]},e.id))})]}),(0,a.jsx)("div",{className:"p-4 border-t bg-muted",children:(0,a.jsxs)("div",{className:"flex justify-between items-center font-semibold",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{className:"text-lg",children:[E().toLocaleString()," DZD"]})]})})]})]})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Order Details"})}),(0,a.jsxs)(o.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Status"}),(0,a.jsxs)(m.l6,{value:g.status,onValueChange:e=>C({...g,status:e}),children:[(0,a.jsx)(_,{children:(0,a.jsx)(m.yv,{})}),(0,a.jsxs)(L,{children:[(0,a.jsx)(k,{value:"pending",children:"Pending"}),(0,a.jsx)(k,{value:"processing",children:"Processing"}),(0,a.jsx)(k,{value:"shipped",children:"Shipped"}),(0,a.jsx)(k,{value:"delivered",children:"Delivered"}),(0,a.jsx)(k,{value:"cancelled",children:"Cancelled"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Expected Delivery"}),(0,a.jsx)(d.p,{type:"date",value:g.expectedDelivery,onChange:e=>C({...g,expectedDelivery:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Shipping Address (Optional)"}),(0,a.jsx)(u.T,{placeholder:"Leave empty to use client's address",value:g.shippingAddress,onChange:e=>C({...g,shippingAddress:e.target.value}),rows:3})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Notes"}),(0,a.jsx)(u.T,{placeholder:"Add any notes about this order...",value:g.notes,onChange:e=>C({...g,notes:e.target.value}),rows:3})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),(0,a.jsx)(l.$,{type:"submit",disabled:!g.clientId||0===g.items.length,children:"Create Order"})]})]})]})]})}var _=t(40646),L=t(14186),k=t(69074),R=t(27809),P=t(55868),F=t(53904),Z=t(57434),B=t(40868);function T(e){let{log:s,open:t,onOpenChange:d}=e,[x,h]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),{getOrderLogById:p}=(0,B.U)();if((0,r.useEffect)(()=>{m(s)},[s]),!u)return null;console.log("Modal log data:",u),console.log("Orders array:",u.orders);let g=!0===u.loading||x,j=c.L3,f=Array.isArray(u.orders)?u.orders:[],N=f.length;console.log("Processed orders count:",N);let v=async()=>{if(!p||!(null==u?void 0:u.id)){I({title:"Refresh failed",description:"Unable to refresh data. Missing ID or refresh function."});return}try{h(!0),console.log("Manually refreshing log details for ID: ".concat(u.id));let t=await p(u.id);if(t){var e,s;console.log("Successfully refreshed log data:",t),console.log("Refreshed orders count:",(null===(e=t.orders)||void 0===e?void 0:e.length)||0),m(t),I({title:"Refresh successful",description:"Found ".concat((null===(s=t.orders)||void 0===s?void 0:s.length)||0," orders in this log.")})}else console.error("Failed to get fresh log data"),I({title:"Refresh failed",description:"Could not retrieve updated log data."})}catch(e){console.error("Error refreshing log details:",e),I({title:"Refresh error",description:"An error occurred while refreshing data."})}finally{h(!1)}},w=e=>{if(!e)return"Unknown date";try{return e.toLocaleDateString()}catch(e){return console.error("Date formatting error:",e),"Invalid date"}},A=e=>{if(!e)return"Unknown time";try{return e.toLocaleString()}catch(e){return console.error("DateTime formatting error:",e),"Invalid date/time"}};return(0,a.jsx)(c.lG,{open:t,onOpenChange:d,children:(0,a.jsxs)(c.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(c.c7,{children:(0,a.jsxs)(j,{className:"flex items-center space-x-2",children:[(0,a.jsx)(k.A,{className:"h-5 w-5"}),(0,a.jsxs)("span",{children:["Order Daily Log - ",w(u.date)]})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Log Summary"})}),(0,a.jsxs)(o.Wu,{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Date"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:w(u.date)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Status"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[u.isClosed?(0,a.jsx)(_.A,{className:"h-4 w-4 text-green-600"}):(0,a.jsx)(L.A,{className:"h-4 w-4 text-orange-600"}),(0,a.jsx)(n.E,{className:u.isClosed?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800",children:u.isClosed?"Closed":"Open"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Orders"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(R.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"text-lg font-semibold text-blue-600",children:u.totalOrders||0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Value"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsxs)("span",{className:"text-lg font-semibold text-green-600",children:[(u.totalValue||0).toLocaleString()," DZD"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Created By"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(y.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{children:u.createdBy||"Unknown"})]})]}),u.closedAt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Closed At"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{children:A(u.closedAt)})]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(R.A,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:u.totalOrders||0}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Orders"})]})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P.A,{className:"h-8 w-8 text-green-600"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[(u.totalValue||0).toLocaleString()," DZD"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Value"})]})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P.A,{className:"h-8 w-8 text-purple-600"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[u.totalOrders>0?((u.totalValue||0)/u.totalOrders).toLocaleString():0," DZD"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Average Order"})]})]})})})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)(o.ZB,{children:["Orders Added (",g?"...":N,")"]}),(0,a.jsx)(l.$,{variant:"outline",size:"sm",onClick:v,disabled:x||!p,className:"ml-auto",children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),"Refreshing..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F.A,{className:"mr-2 h-4 w-4"}),"Refresh Orders"]})})]}),(0,a.jsx)(o.Wu,{children:g?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center space-x-2 py-4",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 animate-bounce [animation-delay:-0.3s]"}),(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 animate-bounce [animation-delay:-0.15s]"}),(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 animate-bounce"})]}),(0,a.jsx)("p",{children:"Loading order data..."})]}):N>0?(0,a.jsxs)(i.XI,{children:[(0,a.jsx)(i.A0,{children:(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(i.nd,{children:"Order Number"}),(0,a.jsx)(i.nd,{children:"Client Name"}),(0,a.jsx)(i.nd,{children:"Order Total"}),(0,a.jsx)(i.nd,{children:"Added At"}),(0,a.jsx)(i.nd,{children:"Notes"})]})}),(0,a.jsx)(i.BF,{children:f.map((e,s)=>(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(i.nA,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{children:e.orderNumber||e.orderId||"Unknown ID"})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(y.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{children:e.clientName||"Unknown Client"})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsxs)("span",{className:"font-semibold text-green-600",children:[(e.orderTotal||0).toLocaleString()," DZD"]})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{children:A(e.addedAt)})]})}),(0,a.jsx)(i.nA,{children:e.notes?(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(Z.A,{className:"h-4 w-4 text-gray-400 mt-0.5"}),(0,a.jsx)("span",{className:"text-sm",children:e.notes})]}):(0,a.jsx)("span",{className:"text-gray-400",children:"No notes"})})]},e.id||"order-".concat(s,"-").concat(e.orderId)))})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(R.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"No orders added to this log yet"})]})})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Activity Timeline"})}),(0,a.jsx)(o.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Log created"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:A(u.date)})]})]}),f.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:["Order added: ",e.orderNumber||e.orderId||"Unknown"," - ",(e.orderTotal||0).toLocaleString()," DZD"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:A(e.addedAt)})]})]},e.id||"order-".concat(s,"-").concat(e.orderId))),u.isClosed&&u.closedAt&&(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Log closed"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:A(u.closedAt)})]})]})]})})]})]})]})})}var q=t(96371),U=t(5749),E=t(47924),z=t(12486),$=t(92657),M=t(13717),V=t(32919);function W(){let{orders:e,addOrder:s}=(0,q.h)(),{orderLogs:t,createOrderDailyLog:f,addOrderToLog:v,closeOrderDailyLog:w,getOrderLogById:S,refreshOrderLogs:C,addMultipleOrdersToLog:D}=(0,B.U)(),[I,Z]=(0,r.useState)(t),[W,H]=(0,r.useState)(""),[J,K]=(0,r.useState)(1),[G,X]=(0,r.useState)(10),[Q,Y]=(0,r.useState)(null),[ee,es]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(!1),[er,el]=(0,r.useState)(null),[ed,en]=(0,r.useState)({orderId:"",notes:""}),[ei,eo]=(0,r.useState)(""),[ec,ex]=(0,r.useState)(1),[eh,eu]=(0,r.useState)(5),[em,ep]=(0,r.useState)(null),[eg,ej]=(0,r.useState)("all"),[ef,ey]=(0,r.useState)([]),[eN,ev]=(0,r.useState)(!1),[ew,eb]=(0,r.useState)(null),[eA,eS]=(0,r.useState)(!1),[eC,eD]=(0,r.useState)(!1),eI=e=>{let s="asc";Q&&Q.key===e&&"asc"===Q.direction&&(s="desc"),Y({key:e,direction:s})},eO=e=>{let s="asc";em&&em.key===e&&"asc"===em.direction&&(s="desc"),ep({key:e,direction:s})};(0,r.useEffect)(()=>{Z(t),console.log("Order logs updated from context:",t)},[t]),(0,r.useEffect)(()=>{(async()=>{try{if((0===t.length||t.some(e=>!e.orders||0===e.orders.length))&&C){console.log("Component mounted, refreshing logs with refreshOrderLogs"),eS(!0);let e=await C();e&&e.length>0?(Z(e),console.log("Successfully refreshed logs:",e)):console.warn("No logs returned from refreshOrderLogs"),eS(!1)}else 0===t.length&&console.warn("No logs available and refreshOrderLogs is not defined")}catch(e){console.error("Failed to refresh all logs:",e),eS(!1)}})()},[]);let e_=[...I.filter(e=>(e.date?e.date.toLocaleDateString():"").includes(W.toLowerCase())||(void 0!==e.totalOrders?e.totalOrders.toString():"").includes(W)||(void 0!==e.totalValue?e.totalValue.toString():"").includes(W))].sort((e,s)=>{if(!Q)return 0;let t=e[Q.key],a=s[Q.key];return void 0===t&&void 0===a?0:void 0===t?1:void 0===a?-1:t<a?"asc"===Q.direction?-1:1:t>a?"asc"===Q.direction?1:-1:0}),eL=Math.ceil(e_.length/G),ek=(J-1)*G,eR=e_.slice(ek,ek+G),eP=e.map(e=>({value:e.id,label:"".concat(e.orderNumber||e.id," - ").concat(e.client.name),email:e.client.email,total:e.total})),eF=[...ef.filter(s=>{let t=e.find(e=>e.id===s.orderId);if(!t)return!1;let a=t.id.toLowerCase().includes(ei.toLowerCase())||t.client.name.toLowerCase().includes(ei.toLowerCase())||t.client.email.toLowerCase().includes(ei.toLowerCase()),r="all"===eg||t.status===eg;return a&&r})].sort((s,t)=>{let a,r;if(!em)return 0;let l=e.find(e=>e.id===s.orderId),d=e.find(e=>e.id===t.orderId);if(!l||!d)return 0;switch(em.key){case"id":a=l.id,r=d.id;break;case"client":a=l.client.name,r=d.client.name;break;case"total":a=l.total,r=d.total;break;case"status":a=l.status,r=d.status;break;case"addedAt":a=s.addedAt,r=t.addedAt;break;default:return 0}return void 0===a&&void 0===r?0:void 0===a?1:void 0===r?-1:a<r?"asc"===em.direction?-1:1:a>r?"asc"===em.direction?1:-1:0}),eZ=Math.ceil(eF.length/eh),eB=(ec-1)*eh,eT=eF.slice(eB,eB+eh),eq=[...new Set(e.map(e=>e.status))],eU=e=>{ey(ef.filter(s=>s.id!==e))},eE=async e=>{let t=String(await s(e)||"ORD-".concat(Date.now()));ey([...ef,{id:Date.now().toString(),orderId:t,clientName:e.client.name,orderTotal:e.total,addedAt:new Date,notes:"",isOriginal:!1}]),U.oR.success("The new order has been added to your system and to this log.",{position:"top-right",autoClose:3e3})},ez=async()=>{let e;if(0===ef.length){U.oR.warning("Please add at least one order before submitting.");return}U.oR.info("Adding ".concat(ef.length," orders to the daily log...")),eD(!0);let s=new Date;try{if(eN&&ew){e=ew.id;let s=(ew.orders||[]).map(e=>e.orderId),t=ef.filter(e=>!s.includes(e.orderId));if(t.length>0){console.log("Adding ".concat(t.length," new orders to existing log ").concat(e));let s=t.map(e=>String(e.orderId)),a=t.map(e=>e.notes||"");if(D)console.log("Using batch order addition"),await D(e,s,a);else{console.log("Batch function not available, adding orders one by one");for(let s=0;s<t.length;s++){let a=t[s],r=String(a.orderId);console.log("Adding order ".concat(s+1," of ").concat(t.length,": ").concat(r));try{s>0&&(console.log("Waiting 800ms before adding next order..."),await new Promise(e=>setTimeout(e,800))),await v(e,r,a.notes),console.log("Successfully added order ".concat(s+1," to log"))}catch(e){console.error("Failed to add order ".concat(s+1," to log:"),e),U.oR.error("Error adding order ".concat(s+1,": There was an issue adding this order. Please try again."))}}}}else console.log("No new orders to add to existing log")}else{let t=ef[0];if(!t||!t.orderId){U.oR.error("Invalid order data: Could not create log with the selected orders. Please try again.");return}let a=String(t.orderId);if(console.log("Creating new order log with first order ID: ".concat(a)),e=await f(s,a),ef.length>1){console.log("New log created with ID: ".concat(e,". Adding ").concat(ef.length-1," additional orders..."));let s=ef.slice(1).map(e=>String(e.orderId)),t=ef.slice(1).map(e=>e.notes||"");if(D)console.log("Using batch order addition for remaining orders"),await D(e,s,t);else{console.log("Batch function not available, adding orders one by one");for(let s=1;s<ef.length;s++){let t=ef[s],a=String(t.orderId);console.log("Adding order ".concat(s," of ").concat(ef.length-1,": ").concat(a));try{console.log("Waiting 800ms before adding next order..."),await new Promise(e=>setTimeout(e,800)),await v(e,a,t.notes),console.log("Successfully added order ".concat(s," to log"))}catch(e){console.error("Failed to add order ".concat(s," to log:"),e),U.oR.error("Error adding order ".concat(s,": There was an issue adding this order. Please try again."))}}}}else console.log("Only one order in log, no additional orders to add")}ey([]),es(!1),ev(!1),eb(null),U.oR.success("".concat(eN?"Daily log updated successfully":"Daily log created successfully",": ").concat(eN?"Updated":"Added"," ").concat(ef.length," orders to ").concat(eN?"the":"today's"," log.")),es(!1);try{if(S&&e){console.log("Fetching fresh log data for newly created log ID: ".concat(e)),U.oR.info("Refreshing data... Getting the latest order log data.");let s=await S(e);if(s){if(console.log("Retrieved fresh log data:",s),console.log("Orders in fresh log:",s.orders),eN){let t=[...I],a=t.findIndex(s=>s.id===e);-1!==a?(t[a]=s,Z(t)):Z([s,...I])}else Z([s,...I])}else if(console.error("Failed to get fresh log data"),C){let e=await C();e&&e.length>0&&console.log("Refreshed all logs after failure to get single log")}}else C&&(console.log("getOrderLogById not available, using refreshOrderLogs"),await C())}catch(e){if(console.error("Error refreshing log data:",e),C)try{await C()}catch(e){console.error("Full refresh also failed:",e)}}}catch(e){console.error("Error submitting daily log:",e),U.oR.error("Submission failed: An error occurred while submitting the daily log. Please try again later.")}finally{eD(!1)}},e$=e=>{el({...e,loading:!0}),ea(!0),S?(console.log("Fetching fresh log data for details view:",e.id),S(e.id).then(s=>{s?(console.log("Retrieved fresh log data:",s),el(s)):(console.error("Failed to get fresh log data, using local state"),el(e))}).catch(s=>{console.error("Error fetching fresh log data:",s),el(e)})):console.warn("getOrderLogById function not available")},eM=e=>e?(0,a.jsx)(_.A,{className:"h-4 w-4 text-green-600"}):(0,a.jsx)(L.A,{className:"h-4 w-4 text-orange-600"}),eV=e=>e?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800",eW=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-purple-100 text-purple-800";case"shipped":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},eH=s=>{eb(s),ev(!0),es(!0),ey((s.orders||[]).map(s=>{let t=e.find(e=>e.id===s.orderId);return t?{id:s.id||Date.now().toString()+Math.random(),orderId:t.id,clientName:t.client.name,orderTotal:t.total,addedAt:s.addedAt||new Date,notes:s.notes||"",isOriginal:!0}:null}).filter(Boolean))},eJ=async()=>{if(!C){console.error("refreshOrderLogs function is not available"),U.oR.error("Refresh failed: Unable to refresh logs due to missing functionality.");return}try{eS(!0);let e=await C();e&&e.length>0?(Z(e),U.oR.success("Refresh successful: Successfully refreshed ".concat(e.length," logs."))):U.oR.warning("No logs found: No logs were returned from the server.")}catch(e){console.error("Error refreshing logs:",e),U.oR.error("Refresh failed: An error occurred while refreshing logs. See console for details.")}finally{eS(!1)}},eK=async e=>{try{U.oR.info("Please wait while we close the log..."),await w(e);let s=I.map(s=>s.id===e?{...s,isClosed:!0,closedAt:new Date}:s);Z(s)}catch(e){console.error("Error closing log:",e),U.oR.error("Failed to close log")}};return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Order Daily Logs"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Track daily order processing and sales activities"})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(o.ZB,{children:"Daily Logs"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(l.$,{variant:"outline",onClick:eJ,disabled:eA,children:eA?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),"Refreshing..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F.A,{className:"mr-2 h-4 w-4"}),"Refresh"]})}),(0,a.jsxs)(c.lG,{open:ee,onOpenChange:es,children:[(0,a.jsx)(c.zM,{asChild:!0,children:(0,a.jsxs)(l.$,{children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"}),eN?"Update Log":"Create Today's Log"]})}),(0,a.jsxs)(c.Cf,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(c.c7,{children:(0,a.jsx)(c.L3,{children:eN?"Update Order Daily Log - ".concat(null==ew?void 0:ew.date.toLocaleDateString()):"Create Order Daily Log - ".concat(new Date().toLocaleDateString())})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Add Order to Log"})}),(0,a.jsx)(o.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Select Existing Order"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Select Order"}),(0,a.jsx)(j.Z,{value:ed.orderId,onValueChange:e=>en({...ed,orderId:e}),options:eP,placeholder:"Select order",searchPlaceholder:"Search orders..."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{htmlFor:"notes",children:"Notes"}),(0,a.jsx)(u.T,{id:"notes",placeholder:"Add any notes about this order...",value:ed.notes,onChange:e=>en({...ed,notes:e.target.value}),rows:3})]}),(0,a.jsx)(l.$,{onClick:()=>{if(ed.orderId){let s=e.find(e=>e.id===ed.orderId);if(s){let e=String(ed.orderId);ey([...ef,{id:Date.now().toString(),orderId:e,clientName:s.client.name,orderTotal:s.total,addedAt:new Date,notes:ed.notes,isOriginal:!1}]),en({orderId:"",notes:""}),U.oR.success("Order added successfully. You can continue adding more orders.",{position:"top-right",autoClose:3e3})}}},disabled:!ed.orderId,className:"w-full",children:"Add Order to Log"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Create New Order"}),(0,a.jsx)(O,{onSubmit:eE,trigger:(0,a.jsxs)(l.$,{className:"w-full",children:[(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"Create New Order"]})})]})]})})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsxs)(o.aR,{children:[(0,a.jsxs)(o.ZB,{children:["Added Orders (",ef.length,")"]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-1",children:[(0,a.jsx)(E.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)(d.p,{placeholder:"Search orders...",value:ei,onChange:e=>eo(e.target.value),className:"max-w-sm"})]}),(0,a.jsxs)(m.l6,{value:eg,onValueChange:ej,children:[(0,a.jsx)(m.bq,{className:"w-full sm:w-[200px]",children:(0,a.jsx)(m.yv,{placeholder:"Filter by status"})}),(0,a.jsxs)(m.gC,{children:[(0,a.jsx)(m.eb,{value:"all",children:"All Statuses"}),eq.map(e=>(0,a.jsx)(m.eb,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]})]})]}),(0,a.jsx)(o.Wu,{children:ef.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(i.XI,{children:[(0,a.jsx)(i.A0,{children:(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(g.a,{sortKey:"id",currentSort:em,onSort:eO,children:"Order Number"}),(0,a.jsx)(g.a,{sortKey:"client",currentSort:em,onSort:eO,children:"Client"}),(0,a.jsx)(i.nd,{children:"Items"}),(0,a.jsx)(g.a,{sortKey:"total",currentSort:em,onSort:eO,children:"Total"}),(0,a.jsx)(g.a,{sortKey:"status",currentSort:em,onSort:eO,children:"Status"}),(0,a.jsx)(i.nd,{children:"Expected Delivery"}),(0,a.jsx)(g.a,{sortKey:"addedAt",currentSort:em,onSort:eO,children:"Added At"}),(0,a.jsx)(i.nd,{children:"Notes"}),(0,a.jsx)(i.nd,{children:"Actions"})]})}),(0,a.jsx)(i.BF,{children:eT.map(s=>{let t=e.find(e=>e.id===s.orderId);return t?(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(i.nA,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:t.orderNumber||t.id})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:t.client.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-muted-foreground",children:[(0,a.jsx)(N.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:t.client.email})]})]})]})}),(0,a.jsxs)(i.nA,{children:[t.items.length," items"]}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsxs)("span",{className:"font-semibold text-green-600",children:[t.total?t.total.toLocaleString():"0"," DZD"]})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsx)(n.E,{className:eW(t.status),children:t.status?t.status.charAt(0).toUpperCase()+t.status.slice(1):"Unknown"})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:t.expectedDelivery?t.expectedDelivery.toLocaleDateString():"No date"})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:s.addedAt?s.addedAt.toLocaleTimeString():"No time"})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsx)("span",{className:"text-sm",children:s.notes||"No notes"})}),(0,a.jsx)(i.nA,{children:(0,a.jsx)(l.$,{variant:"outline",size:"sm",onClick:()=>eU(s.id),children:"Remove"})})]},s.id):null})})]})}),(0,a.jsx)(p.d,{currentPage:ec,totalPages:eZ,pageSize:eh,totalItems:eF.length,onPageChange:ex,onPageSizeChange:e=>{eu(e),ex(1)}})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(R.A,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground/50"}),(0,a.jsx)("p",{children:"No orders added to this log yet"})]})})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(l.$,{variant:"outline",onClick:eN?()=>{ev(!1),eb(null),ey([]),es(!1)}:()=>es(!1),children:"Cancel"}),(0,a.jsxs)(l.$,{onClick:ez,disabled:0===ef.length,children:[(0,a.jsx)(z.A,{className:"mr-2 h-4 w-4"}),eN?"Update Daily Log":"Submit Daily Log"," (",ef.length," orders)"]})]})]})]})]})]})]})}),(0,a.jsxs)(o.Wu,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,a.jsx)(E.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)(d.p,{placeholder:"Search logs...",value:W,onChange:e=>H(e.target.value),className:"max-w-sm"})]}),(0,a.jsxs)(i.XI,{children:[(0,a.jsx)(i.A0,{children:(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(g.a,{sortKey:"date",currentSort:Q,onSort:eI,children:"Date"}),(0,a.jsx)(g.a,{sortKey:"totalOrders",currentSort:Q,onSort:eI,children:"Total Orders"}),(0,a.jsx)(g.a,{sortKey:"totalValue",currentSort:Q,onSort:eI,children:"Total Value"}),(0,a.jsx)(i.nd,{children:"Status"}),(0,a.jsx)(i.nd,{children:"Created By"}),(0,a.jsx)(i.nd,{children:"Closed At"}),(0,a.jsx)(i.nd,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(i.BF,{children:eR.map(e=>{var s;return(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(i.nA,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{children:e.date?e.date.toLocaleDateString():"No date"})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(R.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"font-semibold",children:e.totalOrders})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsxs)("span",{className:"font-semibold text-green-600",children:[e.totalValue?e.totalValue.toLocaleString():"0"," DZD"]})]})}),(0,a.jsx)(i.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[eM(e.isClosed),(0,a.jsx)(n.E,{className:eV(e.isClosed),children:e.isClosed?"Closed":"Open"})]})}),(0,a.jsx)(i.nA,{children:e.createdBy||"System"}),(0,a.jsx)(i.nA,{children:e.closedAt?e.closedAt.toLocaleString():"-"}),(0,a.jsx)(i.nA,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(l.$,{variant:"outline",size:"sm",onClick:()=>e$(e),children:(0,a.jsx)($.A,{className:"h-4 w-4"})}),e.isClosed?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.$,{variant:"outline",size:"sm",onClick:()=>eH(e),children:(0,a.jsx)(M.A,{className:"h-4 w-4"})}),(0,a.jsxs)(x.Lt,{children:[(0,a.jsx)(x.tv,{asChild:!0,children:(0,a.jsx)(l.$,{variant:"outline",size:"sm",children:(0,a.jsx)(V.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(x.EO,{children:[(0,a.jsxs)(x.wd,{children:[(0,a.jsx)(x.r7,{children:"Close Order Daily Log"}),(0,a.jsxs)(x.$v,{children:["Are you sure you want to close this order daily log for ",null===(s=e.date)||void 0===s?void 0:s.toLocaleDateString(),"?",(0,a.jsx)("span",{className:"block mt-2",children:"This action cannot be undone and the log cannot be reopened or modified after closing."})]})]}),(0,a.jsxs)(x.ck,{children:[(0,a.jsx)(x.Zr,{children:"Cancel"}),(0,a.jsx)(x.Rx,{onClick:()=>eK(e.id),children:"Close Log"})]})]})]})]})]})})]},e.id)})})]}),(0,a.jsx)(p.d,{currentPage:J,totalPages:eL,pageSize:G,totalItems:e_.length,onPageChange:K,onPageSizeChange:e=>{X(e),K(1)}})]})]}),(0,a.jsx)(T,{log:er,open:et,onOpenChange:ea})]})}},96371:(e,s,t)=>{"use strict";t.d(s,{OrderProvider:()=>i,h:()=>o});var a=t(95155),r=t(12115),l=t(31886),d=t(5749);let n=(0,r.createContext)(void 0);function i(e){let{children:s}=e,[t,i]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[x,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{c(!0),h(null);try{let e=((await l.N.getAll()).data||[]).map(e=>({id:e.id,orderNumber:e.order_number||"ORD-".concat(e.id.substring(0,8)),client:{id:e.client_id,name:e.client_name||"Unknown Client",email:e.client_email||"",address:e.client_address||"",phoneNumber:e.client_phone||""},items:(e.items||[]).map(e=>({id:e.id,product:{id:e.product_id,name:e.product_name||"Unknown Product",description:e.product_description||"",sellPrice:parseFloat(e.unit_price)||0},quantity:parseInt(e.quantity)||0,unitPrice:parseFloat(e.unit_price)||0,total:parseFloat(e.total)||0})),subtotal:parseFloat(e.total)||0,total:parseFloat(e.total)||0,status:e.status||"pending",orderDate:new Date(e.order_date),expectedDelivery:e.expected_delivery?new Date(e.expected_delivery):new Date,notes:e.notes||""}));i(e)}catch(e){console.error("Failed to fetch orders:",e),h(e.message||"Failed to fetch orders"),i([])}finally{c(!1)}})()},[]);let u=async e=>{try{let s=e.client_id?e:{client_id:e.client.id,order_date:e.order_date||new Date().toISOString().split("T")[0],expected_delivery:e.expectedDelivery,status:e.status||"pending",notes:e.notes,shipping_address:e.client.address,items:e.items.map(e=>({product_id:e.product.id,quantity:e.quantity,unit_price:e.unitPrice}))},t=await l.N.create(s),a={id:t.data.id,orderNumber:t.data.order_number||"ORD-".concat(t.data.id.substring(0,8)),client:{id:t.data.client_id,name:t.data.client_name||"Unknown Client",email:t.data.client_email||"",address:t.data.client_address||"",phoneNumber:t.data.client_phone||""},items:(t.data.items||[]).map(e=>({id:e.id,product:{id:e.product_id,name:e.product_name||"Unknown Product",description:e.product_description||"",sellPrice:parseFloat(e.unit_price)||0},quantity:parseInt(e.quantity)||0,unitPrice:parseFloat(e.unit_price)||0,total:parseFloat(e.total)||0})),subtotal:parseFloat(t.data.total)||0,total:parseFloat(t.data.total)||0,status:t.data.status||"pending",orderDate:new Date(t.data.order_date),expectedDelivery:t.data.expected_delivery?new Date(t.data.expected_delivery):new Date,notes:t.data.notes||""};return i(e=>[...e,a]),d.oR.success("Order #".concat(a.orderNumber," has been created successfully."),{position:"top-right",autoClose:3e3}),a}catch(e){throw console.error("Failed to add order:",e),e}},m=async(e,s)=>{try{let t=s.client_id?s:{client_id:s.client.id,order_date:s.order_date||new Date().toISOString().split("T")[0],expected_delivery:s.expectedDelivery,status:s.status||"pending",notes:s.notes,shipping_address:s.client.address,items:s.items.map(e=>({product_id:e.product.id,quantity:e.quantity,unit_price:e.unitPrice}))},a=await l.N.update(e,t),r={id:a.data.id,orderNumber:a.data.order_number||"ORD-".concat(a.data.id.substring(0,8)),client:{id:a.data.client_id,name:a.data.client_name||"Unknown Client",email:a.data.client_email||"",address:a.data.client_address||"",phoneNumber:a.data.client_phone||""},items:(a.data.items||[]).map(e=>({id:e.id,product:{id:e.product_id,name:e.product_name||"Unknown Product",description:e.product_description||"",sellPrice:parseFloat(e.unit_price)||0},quantity:parseInt(e.quantity)||0,unitPrice:parseFloat(e.unit_price)||0,total:parseFloat(e.total)||0})),subtotal:parseFloat(a.data.total)||0,total:parseFloat(a.data.total)||0,status:a.data.status||"pending",orderDate:new Date(a.data.order_date),expectedDelivery:a.data.expected_delivery?new Date(a.data.expected_delivery):new Date,notes:a.data.notes||""};return i(s=>s.map(s=>s.id===e?r:s)),r}catch(e){throw console.error("Failed to update order:",e),e}},p=async e=>{try{let s=t.find(s=>s.id===e);await l.N.delete(e),i(s=>s.filter(s=>s.id!==e)),d.oR.success("Order #".concat((null==s?void 0:s.orderNumber)||e," has been deleted successfully."),{position:"top-right",autoClose:3e3})}catch(e){throw console.error("Failed to delete order:",e),e}},g=async(e,s)=>{try{let a=await l.N.updateStatus(e,s),r=t.find(s=>s.id===e);if(!r)throw Error("Order with ID ".concat(e," not found"));let d={...r,status:a.data.status||"pending",orderDate:new Date(a.data.order_date),expectedDelivery:a.data.expected_delivery?new Date(a.data.expected_delivery):r.expectedDelivery};return i(s=>s.map(s=>s.id===e?d:s)),d}catch(e){throw console.error("Failed to update order status:",e),e}};return(0,a.jsx)(n.Provider,{value:{orders:t,loading:o,error:x,addOrder:u,updateOrder:m,deleteOrder:p,updateOrderStatus:g},children:s})}function o(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useOrders must be used within an OrderProvider");return e}},99474:(e,s,t)=>{"use strict";t.d(s,{T:()=>d});var a=t(95155),r=t(12115),l=t(53999);let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...r})});d.displayName="Textarea"}},e=>{var s=s=>e(e.s=s);e.O(0,[4277,8543,4692,4810,203,3958,534,697,4710,868,8441,1684,7358],()=>s(42535)),_N_E=e.O()}]);